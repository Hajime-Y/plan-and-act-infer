# 02 Plan-and-Act 推論プロジェクト概要

## 1. プロジェクトの目標

このプロジェクトは、「Plan-and-Act: Improving Planning of Agents for Long-Horizon Tasks」論文の推論部分を実装することを目的としています。この論文は、高レベルの計画と低レベルの行動生成を分離し、動的な再計画を取り入れることで、複雑で長期的なタスクにおけるエージェントのパフォーマンスを向上させる新しいエージェントアーキテクチャを提案しています。

## 2. 背景

従来の 大規模言語モデル（LLM）エージェントは、一貫した計画の維持、環境変化への適応、反復的な行動の回避といった課題により、長期的なタスクに苦労することがよくありました。「Plan-and-Act」論文は、これらの制限に対処するため、以下の主要なアイデアに基づいたアーキテクチャを提案しています。

- **プランナー（Planner）**: 全体的なタスクと現在の状態に基づいて戦略的な計画を作成および改良する高レベルのコンポーネント。LLMの推論能力を活用し、環境からのフィードバックに基づいて**動的な再計画（Dynamic Replanning）**を行います。
- **エグゼキューター（Executor）**: プランナーが概説したステップを実行し、環境と相互作用して新しい観測結果を収集する低レベルのコンポーネント。

この分離と動的な再計画の導入により、プランナーはより高い抽象レベルで戦略的な意思決定に集中でき、エグゼキューターは具体的な実行タスクに専念できるため、より堅牢で適応性のあるエージェント動作が期待されます。

## 3. このプロジェクトのスコープ

このプロジェクトは、論文で説明されているPlan-and-Actフレームワークの**推論メカニズムのみ**に焦点を当てます。目標は、長期的なタスク記述を受け取り、プランナーとエグゼキューターコンポーネントをシミュレートすることによって一連のアクションを生成できるシステムを構築することです。

以下のコンポーネントは、このプロジェクトの**スコープ外**であり、別のプロジェクトで扱われます。
    - プランナーとエグゼキューターをトレーニングするための合成データ生成パイプライン。
    - プランナーとエグゼキューターのモデルトレーニング、ファインチューニング、および評価。

## 4. 主要コンポーネント

このプロジェクトでは、以下の主要コンポーネントを開発します。

- **プランナー（Planner）**:
    - タスク記述と現在の環境状態（観測履歴を含む）を入力として受け取ります。
    - 高レベルの計画（サブゴールまたはステップのシーケンス）を生成します。
    - 思考の連鎖（Chain-of-Thought）や他の推論技術を活用して、堅牢な計画を作成します。
    - エグゼキューターからのフィードバック（実行結果、エラー、新しい観測）に基づいて、計画を**動的に再計画（Dynamic Replanning）**します。これには、計画の修正、ステップの追加・削除、または完全な再生成が含まれます。
- **エグゼキューター（Executor）**:
    - プランナーから現在の計画ステップ（サブゴールまたはアクション指示）を受け取ります。
    - 計画ステップを実行可能な低レベルアクションに変換します。
    - **MCP Tools (主に Playwright MCP)** を介して、（シミュレートされた、または実際の）環境と相互作用し、アクションを実行します。
    - アクションの結果（成功、失敗、返されたデータ）と観測された環境の変化を収集し、プランナーにフィードバックします。
- **推論ループ（Inference Loop）**:
    - プランナーとエグゼキューター間の相互作用フローを調整・制御します。
    - 環境からの新しい観測結果をプランナーにフィードバックし、計画の再評価と適応をトリガーします。
    - タスクが完了するか、定義された停止条件（例：最大ステップ数、タイムアウト）が満たされるまで、計画と実行のサイクルを繰り返します。
- **環境インターフェース（Environment Interface）**:
    - エグゼキューターがMCP Toolsを介して相互作用する環境との通信を抽象化します。
    - このプロジェクトでは、最初はPlaywright MCPを介したWebブラウザ操作を主要な環境と想定しますが、他のツールやシミュレートされた環境にも対応できるような設計を目指します。

## 5. 技術スタック（暫定）

- **プログラミング言語**: Python
- **主要フレームワーク・ライブラリ**:
    - **エージェント実行フレームワーク**: `LangGraph` (プランナーとエグゼキューター間の状態管理とフロー制御のため)
    - **MCPツール連携**: `langchain-mcp-adapters` (LangGraph と MCP Server として動作する Playwright MCP 等のツール群を接続するため)
    - **ツール群**: OSS の `MCP Tools` (特に `Playwright MCP` をエグゼキューターの主要ツールとして使用)
    - **型チェック**: `Pydantic` (データ構造の定義と検証用)
- **環境管理**: `uv`

## 6. 設計上の考慮事項・成果物イメージ

本プロジェクトにおける「成果物」は、以下の開発者向けコンポーネント及びその設計を指します。

- Plan-and-Act推論ループのPython実装（LangGraphベース）。
- モジュール化されたプランナーおよびエグゼキューターコンポーネントの実装。
    - プランナー: 動的再計画ロジックを含む。
    - エグゼキューター: Playwright MCP等の外部ツール連携機能を含む。
- 環境インターフェースの設計と実装の初期バージョン。
- プロジェクトのアーキテクチャ、各コンポーネント仕様、およびデータフローを記述した設計ドキュメント（本文書群を含む）。

## 7. 今後の展望（スコープ外アイディア）

この推論プロジェクトの基盤の上に、将来的には以下の拡張が考えられます。

- より多様なMCP Toolsとの連携。
- 合成データ生成パイプラインの開発と、それを用いたプランナー／エグゼキューターの学習（SFT）。（別プロジェクトとして構築予定）
- より高度な計画および推論戦略（例：自己反省、過去の経験からの学習）の組み込み。
